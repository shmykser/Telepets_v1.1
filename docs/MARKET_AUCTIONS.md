# Рынок и аукционы питомцев

Документ описывает модель данных, бизнес-правила и API для аукционной продажи питомцев.

## Правила
- Продавать можно питомцев в любой стадии (egg, baby, adult), но только живых.
- Тип аукциона: восходящий (English). Минимальный шаг: 5% от текущей цены, но не меньше 1 монеты.
- Длительность по умолчанию 60 минут. Soft-close: продление на 60 сек, если ставка поступает в последние 60 сек.
- Опциональный buy-now.
- Монеты на ставку замораживаются (holds). Предыдущему лидеру hold освобождается при перебитии.
- Завершение: перевод монет и права собственности, комиссия 5%.

## Настройки
Ключи добавлены в `backend/config/settings.py`:
- `MARKET_ENABLED`, `AUCTION_DEFAULT_DURATION_SECONDS`, `AUCTION_SOFT_CLOSE_SECONDS`
- `AUCTION_MIN_BID_INCREMENT_PERCENT`, `AUCTION_MIN_BID_INCREMENT_ABS`
- `AUCTION_MAX_ACTIVE_PER_USER`, `MARKET_FEE_PERCENT`, `AUCTION_LIST_PAGE_SIZE`

## Модель данных
Новые сущности в `backend/models.py`:
- `Auction`, `AuctionBid`, `WalletHold`, `PetOwnershipHistory`
- В `Wallet` добавлено `coins_locked`.
- В `TransactionType` добавлены `market_purchase`, `market_sale`, `market_fee`.

## API
Базовый префикс: `/market`
- `GET /auctions` — листинг активных аукционов
- `GET /auctions/{id}` — детали аукциона
- `POST /auctions` — создание аукциона
- `POST /auctions/{id}/bids` — ставка
- `POST /auctions/{id}/buy_now` — мгновенная покупка
- `POST /auctions/{id}/cancel` — отмена продавцом (если нет ставок)

Примеры запросов и ответов будут добавлены по мере стабилизации контрактов.

## Завершение аукциона
Финализация переводит питомца новому владельцу и создаёт соответствующие транзакции. В следующей версии добавим фоновую задачу для массовой финализации просроченных аукционов.

## Безопасность
- Все денежные операции выполняются транзакционно.
- Холды предотвращают не обеспеченные ставки.
- Валидация бизнес-правил на каждом шаге.


