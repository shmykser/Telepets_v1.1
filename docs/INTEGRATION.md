## Интеграция генератора существ (PetsGenerator) в Telepets

### Ключевые изменения (актуально)

- Единый конфиг в `backend/config/settings.py` теперь содержит настройки генерации изображений (HF API, модели, пресеты качества, стадийные промпты). `PetsGenerator/config/settings.py` импортирует их при наличии, что устраняет дублирование.
- Добавлен `backend/prompt_store.py` — при создании питомца сохраняются промпты для стадий (egg/baby/adult) и описание существа. Изображения генерируются по запросу.
- Эндпоинт `GET /pet-images/{user_id}/{pet_name}` теперь отдаёт изображение из БД (base64 PNG). При отсутствии изображения — генерирует, сохраняет в БД и возвращает (HF или SVG fallback).
- Фронтенд переработан: изображение питомца занимает большую часть экрана (адаптация под Telegram Web App). Подключен скрипт инициализации WebApp.

### Переменные окружения (.env)

Добавьте вручную:

```
HF_API_TOKEN=hf_...
TELEGRAM_BOT_TOKEN=...
DATABASE_URL=sqlite:///./telepets.db
API_HOST=127.0.0.1
API_PORT=3000
```

### Поток стадий

1. Создание питомца (`POST /create`):
   - Стадия `egg`.
   - Генератор сохраняет промпты для `baby` и `adult` без генерации изображений.
2. Игрок поддерживает здоровье. Фоновая задача уменьшает здоровье и переводит стадию по интервалам.
3. При переходе на новую стадию фронт запрашивает картинку у `GET /pet-images/...`:
   - Если питомец жив — генерируется изображение текущей стадии (если его нет в БД), сохраняется в БД и возвращается.
4. Повторяется до `adult` или `dead`.

### Каталоги и кэш

- Для совместимости генераторы могут временно сохранять файлы в `cache/pet_images/`, однако источником истины является БД (поля `image_*_b64`).
 
### Alembic (миграции)

- Используется Alembic для управления схемой БД. Перед запуском примените миграции: `alembic upgrade head`.

### Swagger

- Эндпоинты доступны в `/docs`. Обновлён `backend/docs/pet_images_api.md`.

### Мульти‑питомцы / карусель

- Пользователь может иметь несколько питомцев
- Создание нового: только если все живые — в `adult` (или все мёртвые)
- Переключение: стрелки/свайпы (Embla)
- Карусель сортирует: живые → мёртвые; внутри группы — по дате создания (сначала новые)

### Экономика

- Единый кошелёк игрока
- `POST /economy/actions/{user_id}/health_up?pet_name=...` — платное увеличение здоровья
- Фронт блокирует кнопку при недостатке монет, выполняет оптимистичные обновления UI




